% title 'CPanel';
% layout 'default';
%
% my $content_length = 10;
% my $recent_update_length = 10;

<script type="text/javascript">//<![CDATA[

    dojo.require("dijit.layout.TabContainer");
    dojo.require("dijit.layout.ContentPane");
    dojo.require("dijit.form.Textarea");
    dojo.require("dijit.form.MultiSelect");
    dojo.require("dijit.Dialog");
    dojo.require("dijit.Menu");

    <% unless ( $self->session('admin') ) { %>

    dojo.addOnLoad(function() {

        dijit.byId("dialog_login").show();

    });

    <% } %>

//]]></script>

<% if ( $self->session('admin') ) { %>

<div class="content_left">

    <a href="/home"><h1>Home</h1></a>

    <% my $home_counter; %>
    
    <% for my $home ( @{$self->{CONTENT}} ) { %>

        <% if ($home->pages =~ m/home/i ) { %>
        
        <% next if $home->types =~ m/ad_header|ad_block|gallery/i; %>
        
        <% $home_counter++; %>
        
        <h2><a href="/more?id=<%= $home->id%>"><%= $home->title %></a></h2>

        <% for ( split /\s+/, $home->photos ) { %>
        
        <a title="<%= $home->title %>" href="/more?id=<%= $home->id %>">
            <img class="para_image_left_cpanel" src="<%= $_ %>" />
        </a>
        
        <% last; %>
        
        <% } %>
        
        <% if ($home->body ne '') { %>
        
        <p><%= substr( HTML::FormatText->format_string($home->body), 0, 200 ) . '...' %></p>
    
        <% } %>
        
        <div class="read_more_right">
            
            <% if ( $self->session('admin') ) { %>
    
            <a href="/more?id=<%= $home->id %>">Read More |</a>
            <a href="/cpanel/content/form?mode=update&id=<%= $home->id %>">Edit</a>        
        
            <% } else { %>
        
            <a href="/more?id=<%= $home->id %>">Read More...</a>
            
            <% } %>
        
        </div>
        
        <div class="content_spacer"></div>
    
        <% } %>
        
        <% last if $home_counter == $content_length; %>
        
    <% } %>

    <h3><a href="/search?pages=home">More Home</a></h3>
    
    <a href="/live"><h1>Live</h1></a>

    <% my $live_counter; %>
    
    <% for my $live ( @{$self->{CONTENT}} ) { %>

        <% if ($live->pages =~ m/live/i ) { %>
        
        <% next if $live->types =~ m/ad_header|ad_block|gallery/i; %>

        <% $live_counter++; %>

        <h2><a href="/more?id=<%= $live->id%>"><%= $live->title %></a></h2>

        <% for ( split /\s+/, $live->photos ) { %>
        
        <a title="<%= $live->title %>" href="/more?id=<%= $live->id %>">
            <img class="para_image_left_cpanel" src="<%= $_ %>" />
        </a>
        
        <% last; %>
        
        <% } %>
        
        <% if ($live->body ne '') { %>
        
        <p><%= substr( HTML::FormatText->format_string($live->body), 0, 200 ) . '...' %></p>
    
        <% } %>
        
        <div class="read_more_right">
            
            <% if ( $self->session('admin') ) { %>
    
            <a href="/more?id=<%= $live->id %>">Read More |</a>
            <a href="/cpanel/content/form?mode=update&id=<%= $live->id %>">Edit</a>        
        
            <% } else { %>
        
            <a href="/more?id=<%= $live->id %>">Read More...</a>
            
            <% } %>
        
        </div>
        
        <div class="content_spacer"></div>
    
        <% } %>

        <% last if $live_counter == $content_length; %>

    <% } %>

    <h3><a href="/search?pages=live">More Live</a></h3>

    <a href="/work"><h1>Work</h1></a>

    <% my $work_counter; %>

    <% for my $work ( @{$self->{CONTENT}} ) { %>

        <% if ($work->pages =~ m/work/i ) { %>
        
        <% next if $work->types =~ m/ad_header|ad_block|gallery/i; %>
        
        <% $work_counter++; %>
        
        <h2><a href="/more?id=<%= $work->id%>"><%= $work->title %></a></h2>

        <% for ( split /\s+/, $work->photos ) { %>
        
        <a title="<%= $work->title %>" href="/more?id=<%= $work->id %>">
            <img class="para_image_left_cpanel" src="<%= $_ %>" />
        </a>
        
        <% last; %>
        
        <% } %>
        
        <% if ($work->body ne '') { %>
        
        <p><%= substr( HTML::FormatText->format_string($work->body), 0, 200 ) . '...' %></p>
    
        <% } %>
        
        <div class="read_more_right">
            
            <% if ( $self->session('admin') ) { %>
    
            <a href="/more?id=<%= $work->id %>">Read More |</a>
            <a href="/cpanel/content/form?mode=update&id=<%= $work->id %>">Edit</a>        
        
            <% } else { %>
        
            <a href="/more?id=<%= $work->id %>">Read More...</a>
            
            <% } %>
        
        </div>
        
        <div class="content_spacer"></div>
        
        <% } %>
        
        <% last if $work_counter == $content_length; %>
    
    <% } %>

    <h3><a href="/search?pages=work">More Work</a></h3>

    <a href="/play"><h1>Play</h1></a>

    <% my $play_counter; %>

    <% for my $play ( @{$self->{CONTENT}} ) { %>

        <% if ($play->pages =~ m/play/i ) { %>

        <% next if $play->types =~ m/ad_header|ad_block|gallery/i; %>
        
        <% $play_counter++; %>

        <h2><a href="/more?id=<%= $play->id%>"><%= $play->title %></a></h2>

        <% for ( split /\s+/, $play->photos ) { %>
        
        <a title="<%= $play->title %>" href="/more?id=<%= $play->id %>">
            <img class="para_image_left_cpanel" src="<%= $_ %>" />
        </a>
        
        <% last; %>
        
        <% } %>
        
        <% if ($play->body ne '') { %>
        
        <p><%= substr( HTML::FormatText->format_string($play->body), 0, 200 ) . '...' %></p>
    
        <% } %>
        
        <div class="read_more_right">
            
            <% if ( $self->session('admin') ) { %>
    
            <a href="/more?id=<%= $play->id %>">Read More |</a>
            <a href="/cpanel/content/form?mode=update&id=<%= $play->id %>">Edit</a>        
        
            <% } else { %>
        
            <a href="/more?id=<%= $play->id %>">Read More...</a>
            
            <% } %>
        
        </div>
        
        <div class="content_spacer"></div>
        
        <% } %>

        <% last if $play_counter == $content_length; %>

    <% } %>

    <h3><a href="/search?pages=play">More Play</a></h3>

    <a href="/photos"><h1>Photos</h1></a>

    <% my $photos_counter; %>

    <% for my $photos ( @{$self->{CONTENT}} ) { %>

        <% if ($photos->pages =~ m/photos/i ) { %>
        
        <% next if $photos->types =~ m/ad_header|ad_block/i; %>
        
        <% $photos_counter++; %>

        <h2><a href="/more?id=<%= $photos->id%>"><%= $photos->title %></a></h2>

        <% for ( split /\s+/, $photos->photos ) { %>
        
        <a title="<%= $photos->title %>" href="/more?id=<%= $photos->id %>">
            <img class="para_image_left_cpanel" src="<%= $_ %>" />
        </a>
        
        <% last; %>
        
        <% } %>
        
        <% if ($photos->body ne '') { %>
        
        <p><%= substr( HTML::FormatText->format_string($photos->body), 0, 200 ) . '...' %></p>
    
        <% } %>
        
        <div class="read_more_right">
            
            <% if ( $self->session('admin') ) { %>
    
            <a href="/more?id=<%= $photos->id %>">Read More |</a>
            <a href="/cpanel/content/form?mode=update&id=<%= $photos->id %>">Edit</a>        
        
            <% } else { %>
        
            <a href="/more?id=<%= $photos->id %>">Read More...</a>
            
            <% } %>
        
        </div>
        
        <div class="content_spacer"></div>
    
        <% } %>
    
        <% last if $photos_counter == $content_length; %>

    <% } %>

    <h3><a href="/search?pages=photos">More Photos</a></h3>

    <a href="/about"><h1>About</h1></a>

    <% my $about_counter; %>

    <% for my $about ( @{$self->{CONTENT}} ) { %>

        <% if ($about->pages =~ m/about/i ) { %>
        
        <% next if $about->types =~ m/ad_header|ad_block|gallery/i; %>
        
        <% $about_counter++; %>

        <h2><a href="/more?id=<%= $about->id%>"><%= $about->title %></a></h2>

        <% for ( split /\s+/, $about->photos ) { %>
        
        <a title="<%= $about->title %>" href="/more?id=<%= $about->id %>">
            <img class="para_image_left_cpanel" src="<%= $_ %>" />
        </a>
        
        <% last; %>
        
        <% } %>
        
        <% if ($about->body ne '') { %>
        
        <p><%= substr( HTML::FormatText->format_string($about->body), 0, 200 ) . '...' %></p>
    
        <% } %>
        
        <div class="read_more_right">
            
            <% if ( $self->session('admin') ) { %>
    
            <a href="/more?id=<%= $about->id %>">Read More |</a>
            <a href="/cpanel/content/form?mode=update&id=<%= $about->id %>">Edit</a>        
        
            <% } else { %>
        
            <a href="/more?id=<%= $about->id %>">Read More...</a>
            
            <% } %>
        
        </div>
        
        <div class="content_spacer"></div>
    
        <% } %>
        
        <% last if $about_counter == $content_length; %>
    
    <% } %>

    <h3><a href="/search?pages=about">More About</a></h3>

    <a href="#"><h1>None</h1></a>

    <% for my $none ( @{$self->{CONTENT}} ) { %>

        <% if ($none->pages =~ m/none/i ) { %>
                
        <h2><a href="/more?id=<%= $none->id %>&back=cpanel"><%= $none->title %></a></h2>
    
        <h3>
            <a href="/cpanel/content/form?mode=update&id=<%= $none->id %>">Edit</a>
            <a href="/cpanel/content/remove?id=<%= $none->id %>">Remove</a>
        </h3>
    
        <% } %>
    
    <% } %>
    
    <h3><a href="/search?pages=none">More None</a></h3>

</div>

<div class="content_right">

    <h1>Recent Updates</h1>

    <div class="content_right_padding">
        
        <% my $recent_updates_counter; %>
        
        <% for my $recent_updates (@{$self->{QUICK_EDITS}}) { %>
        
            <% $recent_updates_counter++; %>
            
            <% next if $recent_updates_counter > $recent_update_length; %>
        
            <% for ( split /\s+/, $recent_updates->photos ) { %>
            
            <a title="<%= $recent_updates->title %>" href="/more?id=<%= $recent_updates->id %>">
                <img class="block_thumbnails_right" src="<%= $_ %>"/>
            </a>
            
            <% last; #JUST SHOW ONE %>
            
            <% } %>
            
            <div class="block_title"><%= $recent_updates->title %></div>
            
            <div class="block_text">
                
                <% if ($recent_updates->body ne '') { %>
                
                <%== substr( HTML::FormatText->format_string($recent_updates->body), 0, 100 ) %> ... 
                
                <% } %>
                
            </div>
            
            <div class="read_more_left">
    
                <a href="/more?id=<%= $recent_updates->id %>">Read More |</a>
                <a href="/cpanel/content/form?mode=update&id=<%= $recent_updates->id %>">Edit</a>        
    
            </div>
    
            <% if ($recent_updates_counter < $recent_update_length) { %>
            
            <hr />
            
            <% } %>
        
        <% } %>

    </div>
    
    <h1>Documentation</h1>

    <div class="content_right_padding">

    <p>Documentation is coming soon. :)</p>
    
    </div>    
    
</div>

<!-- CPanel Menu -->

<div id="cpanel_menu" dojoType="dijit.Menu" contextMenuForWindow="true" style="display: none;">

    <div dojoType="dijit.MenuItem" onClick="dijit.byId('dialog_settings').show();">
        Edit Settings
    </div>

    <div dojoType="dijit.MenuItem" onClick="javascript:window.location='/cpanel/content/form?mode=create';">
        Add Content
    </div>

    <div dojoType="dijit.MenuSeparator"></div>

    <% for (1..4) { %>

    <div dojoType="dijit.MenuItem" onClick="dijit.byId('dialog_<%= $_ %>').show();">
        Dummy Item <%= $_ %>
    </div>

    <% } %>

</div>

<% } %>

<!-- CPanel Login -->

<div id="dialog_login" dojoType="dijit.Dialog" title="CPanel Login">

    <div dojoType="dijit.form.Form" encType="multipart/form-data" action="/cpanel/login" method="POST">

        Admin: <div dojoType="dijit.form.TextBox" name="admin"></div>

        <br />
        <br />

        Password: <div dojoType="dijit.form.TextBox" name="password" type="password"></div>

        <button dojoType="dijit.form.Button" type="submit">Login</button>

    </div>
</div>

<% if ( $self->session('admin') ) { %>

<!-- Edit Settings -->

<div id="dialog_settings" dojoType="dijit.Dialog" title="Edit Settings" style="width: 800px; height: 600px;">

    <div dojoType="dijit.form.Form" encType="multipart/form-data" action="/cpanel/settings" method="POST">

        Admin: <div dojoType="dijit.form.TextBox" name="admin" value="<%= $self->{SETTINGS}->admin %>"></div>

        <br />
        <br />

        New Password: <div dojoType="dijit.form.TextBox" name="password_1" type="password"></div>

        ... Again: <div dojoType="dijit.form.TextBox" name="password_2" type="password"></div>

        <br />
        <br />

        About: <textarea dojoType="dijit.form.Textarea" name="about" style="width: 400px;"><%= $self->{SETTINGS}->about %></textarea>

        <br />
        <br />

        <button dojoType="dijit.form.Button" type="submit">Edit</button>

    </div>

</div>

<% } %>
